%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Weak forms} \label{it.scalar.weak}

Various weak forms for the transformed indirect formulation of the scalar Helmholtz equation are summarized in this subsection. Derivations follow in subsequent subsections.

\paragraph{General case---monolithic formulation}
%
\begin{align*}
    \int_{\Omega} {
        E_{ij} \kernel{u}_{,j} \bar{v}_{,i} \dx
    } + \int_{\Omega} {
        \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} \bar{v} \dx
    } + \imag \int_{\Omega} {
        \left(
        \wavenum_{i} E_{ij} \kernel{u}_{,j} \bar{v}
        - \kernel{u} \bar{v}_{,i} E_{ij} \wavenum_{j}
        \right) \dx
    } &=
    \omega^2 \int_{\Omega} { \rho \kernel{u} \bar{v} \dx }
    \tag{\ref{eq:it.scalar.weak.general}}
\end{align*}


\paragraph{Isotropic modulus---monolithic formulation}
%
\begin{align}
    \int_{\Omega} {
        E \kernel{u}_{,i} \bar{v}_{,i} \dx
    } + \int_{\Omega} {
        \wavenum_{i} E \wavenum_{i} \kernel{u} \bar{v} \dx
    } + \imag \int_{\Omega} {
        E \wavenum_{i} \left(
        \kernel{u}_{,i} \bar{v} - \kernel{u} \bar{v}_{,i}
        \right) \dx
    } &=
    \omega^2 \int_{\Omega} { \rho \kernel{u} \bar{v} \dx }
    \tag{\ref{eq:it.scalar.weak.iso}}
\end{align}


\paragraph{Lossless, anisotropic modulus---split formulation}
%
\begin{align}
    \mathrm{Real:}& & \int_{\Omega} {
        E_{ij} \kernel{u}_{,j} v_{,i} \dx
    } + \int_{\Omega} {
        \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} v \dx
    } &= \omega^2 \int_{\Omega} {
        \rho \kernel{u} v \dx
    } \tag{\ref{eq:it.scalar.weak.general-split.lossless.real}} \\
    %
    \mathrm{Imag:}& & \int_{\Omega} {
        \wavenum_{i} E_{ij} \kernel{u}_{,j} v \dx
    } - \int_{\Omega} {
        E_{ij} \kernel{u} v_{,i} \wavenum_{j} \dx
    } &= 0 \tag{\ref{eq:it.scalar.weak.general-split.lossless.imag}}
\end{align}


\paragraph{Lossless, isotropic modulus---split formulation}
%
\begin{align*}
    \mathrm{Real:}& & \int_{\Omega} {
        E \kernel{u}_{,i} v_{,i} \dx
    } + \int_{\Omega} {
        E \wavenum_{i} \wavenum_{i} \kernel{u} v \dx
    } &= \omega^2 \int_{\Omega} {
        \rho \kernel{u} v \dx
    } \tag{\ref{eq:it.scalar.weak.iso-split.lossless.real}} \\
    %
    \mathrm{Imag:}& & \int_{\Omega} {
        \wavenum_{i} E \kernel{u}_{,i} v \dx
    } - \int_{\Omega} {
        E \kernel{u} v_{,i} \wavenum_{i} \dx
    } &= 0 \tag{\ref{eq:it.scalar.weak.iso-split.lossless.imag}}
\end{align*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Derivation of transformed strong form}
\label{sec:it.scalar.strong-derivation}

Consider the eigenproblem (\ref{eq:prob.scalar}) and insert the Bloch ansatz (\ref{eq:prob.bloch-ansatz}):
%
\begin{align*}
    \left(
        E_{ij}(\vecx) \left[\kernel{u}(\vecx) \blochcomp{k}\right]_{,j}
    \right)_{,i} &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        E_{ij}(\vecx) \left[
            \kernel{u}_{,j}(\vecx) \blochcomp{k}
            + \kernel{u}(\vecx) (\blochcomp{k})_{,j}
        \right]
    \right)_{,i} &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        E_{ij}(\vecx) \left[
            \kernel{u}_{,j}(\vecx) \blochcomp{k}
            + \kernel{u}(\vecx) \blochcomp{m} (-\imag \wavenum_{k} \delta_{kj})
        \right]
    \right)_{,i} &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        E_{ij}(\vecx) \left[
            \kernel{u}_{,j}(\vecx) \blochcomp{k}
            - \imag \wavenum_{j} \kernel{u}(\vecx) \blochcomp{k}
        \right]
    \right)_{,i} &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        E_{ij}(\vecx) \kernel{u}_{,j}(\vecx) \blochcomp{k}
        - \imag E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx) \blochcomp{k}
    \right)_{,i} &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        E_{ij}(\vecx) \kernel{u}_{,j}(\vecx) \blochcomp{k}
    \right)_{,i}
    - \imag \left(
        E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx) \blochcomp{k}
    \right)_{,i} &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        \left[
            E_{ij}(\vecx) \kernel{u}_{,j}(\vecx)
        \right]_{,i} \blochcomp{k}
        -\imag \wavenum_{i} E_{ij}(\vecx) \kernel{u}_{,j}(\vecx) \blochcomp{k}
    \right)& \\
    - \imag \left(
        \left[
            E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx)
        \right]_{,i} \blochcomp{k}
        - \imag \wavenum_{i} E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx)
        \blochcomp{k}
    \right) &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \blochcomp{k} \\
    %
    \left(
        \left[
            E_{ij}(\vecx) \kernel{u}_{,j}(\vecx)
        \right]_{,i}
        -\imag \wavenum_{i} E_{ij}(\vecx) \kernel{u}_{,j}(\vecx)
    \right)& \\
    - \imag \left(
        \left[
            E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx)
        \right]_{,i}
        - \imag \wavenum_{i} E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx)
    \right) &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx)
\end{align*}
%
The most general form of the transformed strong form is:
%
\begin{align}
    \left(
        \left[ E_{ij}(\vecx) \kernel{u}_{,j}(\vecx) \right]_{,i}
        - \wavenum_{i} E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx)
    \right) - \imag \left(
        \left[
            E_{ij}(\vecx) \wavenum_{j} \kernel{u}(\vecx)
        \right]_{,i}
        + \wavenum_{i} E_{ij}(\vecx) \kernel{u}_{,j}(\vecx)
    \right) &=
    -\omega^2 \rho(\vecx) \kernel{u}(\vecx) \label{eq:it.scalar.strong.general}
\end{align}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Derivation of weak form---monolithic formulation} \label{sec:it.scalar.weak-monolithic-derivation}

The weak form is obtained by multiplying the strong form (\ref{eq:it.scalar.strong.general}) with the complex conjugate \(\bar{v}\) of a test function \(v\) and integrating over the unit cell. Like the trial function, the test function is periodic on the unit cell. For conciseness, we omit the function notation ``\((\vecx)\)'', but it is to be understood that the trial and test functions \(\kernel{u}\) and \(v\), as well as the modulus \(E_{ij}\) and density \(\rho\), are functions of position.


\paragraph{General case}
%
\begin{align}
    \int_{\Omega} {
        \left(
            \left[ E_{ij} \kernel{u}_{,j} \right]_{,i}
            - \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u}
        \right) \bar{v} \dx
    } - \imag \int_{\Omega} {
        \left(
            \left[
                E_{ij} \wavenum_{j} \kernel{u}
            \right]_{,i}
            + \wavenum_{i} E_{ij} \kernel{u}_{,j}
        \right) \bar{v} \dx
    } &=
    -\omega^2 \int_{\Omega} {
        \rho \kernel{u} \bar{v} \dx
    } \nonumber \\
    %
    \int_{\Omega} {
        \left[ E_{ij} \kernel{u}_{,j} \right]_{,i} \bar{v} \dx
    } - \int_{\Omega} {
        \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} \bar{v} \dx
    } - \imag \int_{\Omega} {
        \left[ E_{ij} \wavenum_{j} \kernel{u} \right]_{,i} \bar{v} \dx
    } - \imag \int_{\Omega} {
        \wavenum_{i} E_{ij} \kernel{u}_{,j} \bar{v} \dx
    } &=
    -\omega^2 \int_{\Omega} {
        \rho \kernel{u} \bar{v} \dx
    } \nonumber \\
    %
    \int_{\Omega} {
        \left(
            \left[ E_{ij} \kernel{u}_{,j} \bar{v} \right]_{,i}
            - E_{ij} \kernel{u}_{,j} \bar{v}_{,i}
        \right) \dx
    } - \int_{\Omega} {
        \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} \bar{v} \dx
    } & \nonumber \\
    - \imag \int_{\Omega} {
        \left(
        \left[ E_{ij} \wavenum_{j} \kernel{u} \bar{v} \right]_{,i}
        - E_{ij} \wavenum_{j} \kernel{u} \bar{v}_{,i}
        \right) \dx
    } - \imag \int_{\Omega} {
        \wavenum_{i} E_{ij} \kernel{u}_{,j} \bar{v} \dx
    } &=
    -\omega^2 \int_{\Omega} { \rho \kernel{u} \bar{v} \dx } \nonumber \\
    %
    \int_{\partial \Omega} {
        E_{ij} \kernel{u}_{,j} \bar{v} n_i \ds
    } - \int_{\Omega} {
        E_{ij} \kernel{u}_{,j} \bar{v}_{,i} \dx
    } - \int_{\Omega} {
        \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} \bar{v} \dx
    } & \nonumber \\
    - \imag \int_{\partial \Omega} {
        E_{ij} \wavenum_{j} \kernel{u} \bar{v} n_i \ds
    } + \imag \int_{\Omega} {
        E_{ij} \wavenum_{j} \kernel{u} \bar{v}_{,i} \dx
    } - \imag \int_{\Omega} {
        \wavenum_{i} E_{ij} \kernel{u}_{,j} \bar{v} \dx
    } &=
    -\omega^2 \int_{\Omega} { \rho \kernel{u} \bar{v} \dx } \nonumber
    %
    \intertext{The surface integrals are identically 0 because of the periodicity of \(\kernel{u}\) and \(v\) and can be dropped, leading to the transformed weak form for the general case:}
    %
    \int_{\Omega} {
        E_{ij} \kernel{u}_{,j} \bar{v}_{,i} \dx
    } + \int_{\Omega} {
        \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} \bar{v} \dx
    } + \imag \int_{\Omega} {
        \Bigl(
            \wavenum_{i} E_{ij} \kernel{u}_{,j} \bar{v}
            - \kernel{u} \bar{v}_{,i}E_{ij} \wavenum_{j}
        \Bigr)
         \dx
    } &=
    \omega^2 \int_{\Omega} { \rho \kernel{u} \bar{v} \dx }
    \label{eq:it.scalar.weak.general}
\end{align}
%
When $\vect{E}$ is real and symmetric and $\wavevec$ is real, (\ref{eq:it.scalar.weak.general}) is Hermitian and the eigenvalues are real, as expected.


\paragraph{Isotropic case} The weak form (\ref{eq:it.scalar.weak.general}) can be simplified when the modulus is isotropic, i.e. \(E_{ij}(\vecx) = E(\vecx) \delta_{ij}\):
%
\begin{align}
    \int_{\Omega} {
        E \kernel{u}_{,i} \bar{v}_{,i} \dx
    } + \int_{\Omega} {
        \wavenum_{i} E \wavenum_{i} \kernel{u} \bar{v} \dx
    } + \imag \int_{\Omega} {
        E \wavenum_{i} \left(
            \kernel{u}_{,i} \bar{v} - \kernel{u} \bar{v}_{,i}
        \right) \dx
    } &=
    \omega^2 \int_{\Omega} { \rho \kernel{u} \bar{v} \dx }
    \label{eq:it.scalar.weak.iso}
\end{align}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Derivation of weak form---split formulation}
\label{sec:it.scalar.weak-split-derivation}

\paragraph{General case (lossy media)} The functions comprising the integrands in (\ref{eq:it.scalar.weak.general}) are split into their real and imaginary parts:
%
\begin{align}
    & \int_{\Omega} {
        (E^R_{ij} + \imag E^I_{ij})
        (\kernel{u}^R_{,j} + \imag \kernel{u}^I_{,j})
        (v^R_{,i} - \imag v^I_{,i})
        \dx
    } \nonumber \\
    +& \int_{\Omega} {
        \wavenum_{i}
        (E^R_{ij} + \imag E^I_{ij})
        \wavenum_{j}
        (\kernel{u}^R + \imag \kernel{u}^I)
        (v^R - \imag v^I)
        \dx
    } \nonumber \\
    + & \imag \int_{\Omega} {
    \wavenum_{i}
    (E^R_{ij} + \imag E^I_{ij})
    (\kernel{u}^R_{,j} + \imag \kernel{u}^I_{,j})
    (v^R - \imag v^I)
    \dx
    } \nonumber \\
    - & \imag \int_{\Omega} {
        (E^R_{ij} + \imag E^I_{ij})
        \wavenum_{j}
        (\kernel{u}^R + \imag \kernel{u}^I)
        (v^R_{,i} - \imag v^I_{,i})
        \dx
    } \nonumber \\
    &=
    \omega^2 \int_{\Omega} {
        \rho
        (\kernel{u}^R + \imag \kernel{u}^I)
        (v^R - \imag v^I)
        \dx
    } \nonumber
\end{align}
%
\begin{align}
    & \int_{\Omega} {
        \Bigl(
            \left[
                E^R_{ij} \kernel{u}^R_{,j} v^R_{,i}
                + E^R_{ij} \kernel{u}^I_{,j} v^I_{,i}
                + E^I_{ij} \kernel{u}^R_{,j} v^I_{,i}
                - E^I_{ij} \kernel{u}^I_{,j} v^R_{,i}
            \right]
            + \imag \left[
                E^R_{ij} \kernel{u}^I_{,j} v^R_{,i}
                - E^R_{ij} \kernel{u}^R_{,j} v^I_{,i}
                + E^I_{ij} \kernel{u}^R_{,j} v^R_{,i}
                + E^I_{ij} \kernel{u}^I_{,j} v^I_{,i}
            \right]
        \Bigr)
        \dx
    } \nonumber \\
    +& \int_{\Omega} {
        \wavenum_{i} \Bigl(
            \left[
                E^R_{ij} \kernel{u}^R v^R
                + E^R_{ij} \kernel{u}^I v^I
                + E^I_{ij} \kernel{u}^R v^I
                - E^I_{ij} \kernel{u}^I v^R
                \right]
                + \imag \left[
                E^R_{ij} \kernel{u}^I v^R
                - E^R_{ij} \kernel{u}^R v^I
                + E^I_{ij} \kernel{u}^R v^R
                + E^I_{ij} \kernel{u}^I v^I
            \right]
        \Bigr)
        \wavenum_{j}
        \dx
    } \nonumber \\
    +& \imag \int_{\Omega} {
        \wavenum_{i} \Bigl(
            \left[
                E^R_{ij} \kernel{u}^R_{,j} v^R
                + E^R_{ij} \kernel{u}^I_{,j} v^I
                + E^I_{ij} \kernel{u}^R_{,j} v^I
                - E^I_{ij} \kernel{u}^I_{,j} v^R
            \right]
            + \imag \left[
                E^R_{ij} \kernel{u}^I_{,j} v^R
                - E^R_{ij} \kernel{u}^R_{,j} v^I
                + E^I_{ij} \kernel{u}^R_{,j} v^R
                + E^I_{ij} \kernel{u}^I_{,j} v^I
            \right]
        \Bigr)
        \dx
    } \nonumber \\
    -& \imag \int_{\Omega} {
        \Bigl(
            \left[
                E^R_{ij} \kernel{u}^R v^R_{,i}
                + E^R_{ij} \kernel{u}^I v^I_{,i}
                + E^I_{ij} \kernel{u}^R v^I_{,i}
                - E^I_{ij} \kernel{u}^I v^R_{,i}
            \right]
            + \imag \left[
                E^R_{ij} \kernel{u}^I v^R_{,i}
                - E^R_{ij} \kernel{u}^R v^I_{,i}
                + E^I_{ij} \kernel{u}^R v^R_{,i}
                + E^I_{ij} \kernel{u}^I v^I_{,i}
            \right]
        \Bigr) \wavenum_{j}
        \dx
    } \nonumber \\
    &= \omega^2 \int_{\Omega} {
        \rho
        \Bigl(
            \left[
                \kernel{u}^R v^R + \kernel{u}^I v^I
            \right]
            + \imag \left[
                \kernel{u}^I v^R - \kernel{u}^R v^I
            \right]
        \Bigr)
        \dx
    } \nonumber
\end{align}
%
leading to the split formulation of (\ref{eq:it.scalar.weak.general}) for lossy media:
%
\begin{subequations}
    \small
    \begin{align}
        & \int_{\Omega} {
            \left[
                E^R_{ij} \kernel{u}^R_{,j} v^R_{,i}
                + E^R_{ij} \kernel{u}^I_{,j} v^I_{,i}
                + E^I_{ij} \kernel{u}^R_{,j} v^I_{,i}
                - E^I_{ij} \kernel{u}^I_{,j} v^R_{,i}
            \right]
            \dx
        } + \int_{\Omega} {
            \wavenum_{i}
            \left[
                E^R_{ij} \kernel{u}^R v^R
                + E^R_{ij} \kernel{u}^I v^I
                + E^I_{ij} \kernel{u}^R v^I
                - E^I_{ij} \kernel{u}^I v^R
            \right]
            \wavenum_{j}
            \dx
        } \nonumber \\
        -& \int_{\Omega} {
            \wavenum_{i} \left[
                E^R_{ij} \kernel{u}^I_{,j} v^R
                - E^R_{ij} \kernel{u}^R_{,j} v^I
                + E^I_{ij} \kernel{u}^R_{,j} v^R
                + E^I_{ij} \kernel{u}^I_{,j} v^I
            \right]
            \dx
        } + \int_{\Omega} {
            \left[
                E^R_{ij} \kernel{u}^I v^R_{,i}
                - E^R_{ij} \kernel{u}^R v^I_{,i}
                + E^I_{ij} \kernel{u}^R v^R_{,i}
                + E^I_{ij} \kernel{u}^I v^I_{,i}
            \right]
            \wavenum_{j}
            \dx
        } \nonumber \\
        &= \omega^2 \int_{\Omega} {
            \rho
            \left[
                \kernel{u}^R v^R + \kernel{u}^I v^I
            \right]
            \dx
        } \label{eq:it.scalar.weak.general-split.lossy.real} \\
        %
        & \int_{\Omega} {
            \left[
                E^R_{ij} \kernel{u}^I_{,j} v^R_{,i}
                - E^R_{ij} \kernel{u}^R_{,j} v^I_{,i}
                + E^I_{ij} \kernel{u}^R_{,j} v^R_{,i}
                + E^I_{ij} \kernel{u}^I_{,j} v^I_{,i}
            \right]
            \dx
        } + \int_{\Omega} {
            \wavenum_{i} \left[
                E^R_{ij} \kernel{u}^I v^R
                - E^R_{ij} \kernel{u}^R v^I
                + E^I_{ij} \kernel{u}^R v^R
                + E^I_{ij} \kernel{u}^I v^I
            \right]
            \wavenum_{j}
            \dx
        } \nonumber \\
        +& \int_{\Omega} {
            \wavenum_{i}
            \left[
                E^R_{ij} \kernel{u}^R_{,j} v^R
                + E^R_{ij} \kernel{u}^I_{,j} v^I
                + E^I_{ij} \kernel{u}^R_{,j} v^I
                - E^I_{ij} \kernel{u}^I_{,j} v^R
            \right]
            \dx
        } - \int_{\Omega} {
            \left[
                E^R_{ij} \kernel{u}^R v^R_{,i}
                + E^R_{ij} \kernel{u}^I v^I_{,i}
                + E^I_{ij} \kernel{u}^R v^I_{,i}
                - E^I_{ij} \kernel{u}^I v^R_{,i}
            \right]
            \wavenum_{j}
            \dx
        } \nonumber \\
        &= \omega^2 \int_{\Omega} {
            \rho
            \left[
                \kernel{u}^I v^R - \kernel{u}^R v^I
            \right]
            \dx
        } \label{eq:it.scalar.weak.general-split.lossy.imag}
    \end{align}
    \label{eq:it.scalar.weak.general-split.lossy}
\end{subequations}
%
where (\ref{eq:it.scalar.weak.general-split.lossy.real}) and (\ref{eq:it.scalar.weak.general-split.lossy.imag}) are the real and imaginary parts of (\ref{eq:it.scalar.weak.general}), respectively.

\paragraph{Lossless (possibly anisotropic) media} When the problem is lossless, i.e. $\boldsymbol{E}$ and $\rho$ are real, the split formulation (\ref{eq:it.scalar.weak.general-split.lossy}) can be further simplified:
\begin{subequations}
    \small
    \begin{align}
        \int_{\Omega} {
            E_{ij} \kernel{u}_{,j} v_{,i} \dx
        } + \int_{\Omega} {
            \wavenum_{i} E_{ij} \wavenum_{j} \kernel{u} v \dx
        } &= \omega^2 \int_{\Omega} {
            \rho \kernel{u} v \dx
        } \label{eq:it.scalar.weak.general-split.lossless.real} \\
        %
        \int_{\Omega} {
            \wavenum_{i} E_{ij} \kernel{u}_{,j} v \dx
        } - \int_{\Omega} {
            E_{ij} \kernel{u} v_{,i} \wavenum_{j} \dx
        } &= 0 \label{eq:it.scalar.weak.general-split.lossless.imag}
    \end{align}
    \label{eq:it.scalar.weak.general-split.lossless}
\end{subequations}


\paragraph{Isotropic, lossy media} Equation (\ref{eq:it.scalar.weak.general-split.lossless}) can be simplified when the modulus is isotropic:
%
\begin{subequations}
    \small
    \begin{align}
        & \int_{\Omega} {
            \left[
                E^R \kernel{u}^R_{,i} v^R_{,i}
                + E^R \kernel{u}^I_{,i} v^I_{,i}
                + E^I \kernel{u}^R_{,i} v^I_{,i}
                - E^I \kernel{u}^I_{,i} v^R_{,i}
            \right]
            \dx
        } + \int_{\Omega} {
            \wavenum_{i} \wavenum_{i}
            \left[
                E^R \kernel{u}^R v^R
                + E^R \kernel{u}^I v^I
                + E^I \kernel{u}^R v^I
                - E^I \kernel{u}^I v^R
            \right]
            \dx
        } \nonumber \\
        -& \int_{\Omega} {
            \wavenum_{i} \left[
                E^R \kernel{u}^I_{,i} v^R
                - E^R \kernel{u}^R_{,i} v^I
                + E^I \kernel{u}^R_{,i} v^R
                + E^I \kernel{u}^I_{,i} v^I
            \right]
            \dx
        } + \int_{\Omega} {
            \left[
                E^R \kernel{u}^I v^R_{,i}
                - E^R \kernel{u}^R v^I_{,i}
                + E^I \kernel{u}^R v^R_{,i}
                + E^I \kernel{u}^I v^I_{,i}
            \right]
            \wavenum_{i}
            \dx
        } \nonumber \\
        &= \omega^2 \int_{\Omega} {
            \rho
            \left[
            \kernel{u}^R v^R + \kernel{u}^I v^I
            \right]
            \dx
        } \label{eq:it.scalar.weak.iso-split.lossy.real} \\
        %
        & \int_{\Omega} {
            \left[
                E^R \kernel{u}^I_{,i} v^R_{,i}
                - E^R \kernel{u}^R_{,i} v^I_{,i}
                + E^I \kernel{u}^R_{,i} v^R_{,i}
                + E^I \kernel{u}^I_{,i} v^I_{,i}
            \right]
            \dx
        } + \int_{\Omega} {
            \wavenum_{i} \left[
                E^R \kernel{u}^I v^R
                - E^R \kernel{u}^R v^I
                + E^I \kernel{u}^R v^R
                + E^I \kernel{u}^I v^I
            \right]
            \wavenum_{i}
            \dx
        } \nonumber \\
        +& \int_{\Omega} {
            \wavenum_{i}
            \left[
                E^R \kernel{u}^R_{,i} v^R
                + E^R \kernel{u}^I_{,i} v^I
                + E^I \kernel{u}^R_{,i} v^I
                - E^I \kernel{u}^I_{,i} v^R
            \right]
            \dx
        } - \int_{\Omega} {
            \left[
                E^R \kernel{u}^R v^R_{,i}
                + E^R \kernel{u}^I v^I_{,i}
                + E^I \kernel{u}^R v^I_{,i}
                - E^I \kernel{u}^I v^R_{,i}
            \right]
            \wavenum_{i}
            \dx
        } \nonumber \\
        &= \omega^2 \int_{\Omega} {
            \rho
            \left[
            \kernel{u}^I v^R - \kernel{u}^R v^I
            \right]
            \dx
        } \label{eq:it.scalar.weak.iso-split.lossy.imag}
    \end{align}
    \label{eq:it.scalar.weak.iso-split.lossy}
\end{subequations}
%
where (\ref{eq:it.scalar.weak.iso-split.lossy.real}) and (\ref{eq:it.scalar.weak.iso-split.lossy.imag}) are the real and imaginary parts, respectively.

\paragraph{Lossless isotropic media} When the problem is isotropic and lossless, i.e. $\boldsymbol{E}$ and $\rho$ are real, the split formulation (\ref{eq:it.scalar.weak.iso-split.lossy}) can be further simplified:
\begin{subequations}
    \small
    \begin{align}
        \int_{\Omega} {
            E \kernel{u}_{,i} v_{,i} \dx
        } + \int_{\Omega} {
            E \wavenum_{i} \wavenum_{i} \kernel{u} v \dx
        } &= \omega^2 \int_{\Omega} {
            \rho \kernel{u} v \dx
        } \label{eq:it.scalar.weak.iso-split.lossless.real} \\
        %
        \int_{\Omega} {
            \wavenum_{i} E \kernel{u}_{,i} v \dx
        } - \int_{\Omega} {
            E \kernel{u} v_{,i} \wavenum_{i} \dx
        } &= 0 \label{eq:it.scalar.weak.iso-split.lossless.imag}
    \end{align}
    \label{eq:it.scalar.weak.iso-split.lossless}
\end{subequations}

